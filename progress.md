# Project Progress Log

## [2026-02-28 01:25] 바텀 시트 터치 이벤트 간섭(Leak) 방지 및 UI 안정화

- **메인 카드 드래그 제어**: 바텀 시트(자산 관리, 뉴스 상세 등)가 열려 있을 때 배경의 가로 슬라이드 드래그 기능이 동작하지 않도록 상태 기반(`isAnyModalOpen`) 제어 로직을 구현함.
- **이벤트 전파 차단**: 시트 내부의 터치 이벤트가 배경 컨테이너로 전달되어 의도치 않은 페이지 전환이 일어나는 현상을 막기 위해 `stopPropagation` 및 `onTouch` 핸들러를 보강함.
- **컴포넌트 간 통신 최적화**: `SimpleModeV2Container`와 하위 위젯 간의 콜백 구조를 개선하여 모달 상태를 효율적으로 동기화함.


## [2026-02-28 01:20] 관심 종목 상태 유지 및 뉴스 검색 범위 확장

- **관심 종목 순서 영속성(Persistence) 구현**:
    - `SimpleModeV2Container`에 `localStorage` 연동 로직을 추가하여, 사용자가 변경한 종목 순서가 페이지 새로고침 후에도 초기화되지 않고 유지되도록 개선함.
- **뉴스 피드 검색 범위 확장**:
    - `InvestmentNewsCardV2`의 뉴스 가져오기 로직에서 상위 4개 제한(`slice(0, 4)`)을 제거하여, 사용자의 관심 종목 리스트에 포함된 모든 종목에 대한 최신 뉴스를 수집하도록 확장함.


## [2026-02-28 01:15] 뉴스 썸네일 3단계(3-Tier) Fallback 시스템 구축

- **지능형 썸네일 렌더링 도입**:
    - **1순위 (원본)**: 뉴스에서 제공하는 고유 썸네일 노출.
    - **2순위 (공식 로고)**: 썸네일 부재 시 FMP(Financial Modeling Prep) API를 통해 기업 공식 로고를 자동으로 매칭하여 노출.
    - **3순위 (티커 박스)**: 로고 이미지마저 없을 경우, 해당 종목의 티커를 텍스트로 강조한 세련된 전용 박스 UI로 최종 대체.
- **오류 대응 로직 최적화**: `onError` 이벤트를 체이닝하여 이미지 로딩 실패 시 다음 단계로 즉시 전환되도록 구현했으며, 이를 뉴스 리스트와 상세 시트 모두에 적용함.


## [2026-02-28 01:00] V2 모바일 UI 안정화 및 마켓/뉴스 섹션 고도화

- **터치 인터랙션 안정화 (Flickering Fix)**:
    - `SimpleModeV2Container`의 스와이프 로직에 `dragDirectionLock` 및 `touchAction: pan-y`를 적용하여 수직 스크롤 시 발생하던 의도치 않은 가로 밀림(배경 노출) 현상을 해결함.
- **마켓 종목 위젯(MarketQuoteWidgetV2) 리뉴얼**:
    - 2열 그리드에서 1열 리스트 구조로 개편하여 현대적인 한국 증권 앱 스타일의 가공된 시세 정보를 제공함.
    - SVG 기반의 미니 스파크라인을 도입하여 각 종목의 가격 흐름을 시각화함.
    - 종목 상세 차트에 `Recharts` 라이브러리를 적용하여 볼륨 데이터와 함께 정교한 가격 트렌드를 표시함.
- **투자 뉴스 섹션(InvestmentNewsCardV2) 추가 및 UI 개선**:
    - 사용자의 관심 종목(MyStocks)과 연계된 실시간 구글 뉴스 피드를 대시보드 하단에 구현함.
    - **썸네일 예외 처리(Fallback) 강화**: 썸네일 부재 시 단순 아이콘 대신 연회색 박스에 해당 종목의 `ticker`를 크게 표시하여 가독성 및 디자인 일관성을 확보함.
    - 바텀 시트 형태의 상세 뉴스 보기 기능을 추가하여 외부 브라우저 이동 없이 콘텐츠 확인이 가능하게 함.
- **자산 관리 UI 일관성 강화**:
    - 자산 추가/삭제를 위한 전 전 전용 관리 시트를 연동하고, 프리미엄 톤앤매너에 맞게 시각 요소(아이콘, 컬러)를 정제함.


## [2026-02-27 23:45] V2 마켓 위젯 1열 리스트 개편 및 자산 관리 UI 고도화

- **1열 세로 리스트(1-Column List) 개편**: 기존 2열 그리드 구조를 현대적인 한국 증권 앱 스타일의 1열 리스트로 전면 재설계함.
    - **가독성 중심 레이아웃**: 좌측(티커/이름), 중앙(스파크라인), 우측(가격/등락률 뱃지)의 3분할 구조 적용.
    - **미니 스파크라인(Sparkline)**: SVG 기반의 동적 미니 차트를 구현하여 종목별 가격 흐름을 한눈에 파악 가능하게 함.
    - **뱃지 스타일 등락률**: 등락률을 뱃지 형태로 디자인하고 한국형 컬러 표준(상승-Red, 하락-Blue)을 적용함.
- **바텀 시트(Bottom Sheet) 자산 관리**: 중앙 팝업 대신 하단에서 올라오는 바텀 시트 구조로 전환하여 모바일 최적화 및 연속적인 추가/삭제 UX 구현.
- **검색 API 안정화**:
    - **로컬라이징 시도 및 수정**: 한국 종목명 출력을 위한 `lang`/`region` 파라미터 적용 시 발생하는 API 스키마 검증 오류를 확인하고, 안정성을 위해 해당 파라미터를 제거하되 결과 개수를 늘려 우회적으로 보완함.
    - **검토 범위 확대**: 내부 검색 API를 수정하여 주식, ETF뿐만 아니라 지수(Index)와 환율(Currency)까지 검색되도록 확장함.
- **인터랙션 및 시각 요소 정제**:
    - **애니메이션 최적화**: 불필요한 레이아웃 애니메이션을 제거하고 150ms 이하의 즉각적인 반응을 통해 조작감을 크게 개선함.
    - **컬러 톤 정리**: 자산 관리 UI의 자극적인 빨간색 요소를 차분한 무채색 계열로 조정하여 프리미엄 톤앤매너를 강화함.


## [2026-02-27 20:15] ETFCheck 스타일의 프리미엄 V2 모바일 UI 구현 및 스와이프 인터랙션 최적화

- **V2 병렬 UI 구축**: 기존 시스템에 영향을 주지 않는 독립적인 `/m/v2` 경로와 전용 컴포넌트(`SimpleModeV2Container`, `SimpleModeV2Card`, `NewsSectionV2`) 및 스타일 체계를 완성함.
- **네이버 앱 스타일 스와이프 구현**: `framer-motion`을 활용하여 두 개 이상의 페이지를 가로로 넘길 수 있는 고성능 스와이프 인터페이스를 구축함.
- **피지컬 스와이프 인터랙션 튜닝**:
    - **관성 및 스냅**: 가볍게 튕기면(Flick) 관성에 따라 스르륵 미끄러지고, 멈출 때는 목적지 페이지로 자석처럼 착 달라붙는(Snap) 완벽한 물리 효과 적용.
    - **2/3 임계값**: 화면의 2/3 이상 드래그 시에만 페이지가 전환되도록 설정하여 의도치 않은 조작 방지.
    - **바운스 효과 (Bounce)**: 페이지 끝 도달 및 복귀 시 실제 물체와 같은 탄성 애니메이션 추가.
- **터치 좌표 미스매치 및 하이재킹 해결**: 비활성 페이지에 `pointer-events-none`을 적용하고 픽셀 기반 절대 좌표 로직을 사용하여 터치 포인트와 렌더링 위치가 어긋나는 버그를 수정함.
- **뉴스 섹션 연동**: 대시보드 하단에 실시간 뉴스 피드 레이아웃을 구현하고 프리미엄 카드 스타일을 적용함.


## [2026-02-27 16:11] FluxX PWA (Progressive Web App) 전환 완료

- **PWA 기본 구성**: `manifest.json` 생성 및 서비스 워커(`sw.js`) 연동을 통해 모바일 설치 기반 마련.
- **전용 앱 아이콘**: 프리미엄 "FX" 심볼 기반의 다양한 해상도 아이콘(512px, 192px, Apple Touch Icon) 생성 및 적용.
- **모바일 최적화**: iOS 홈 화면 추가 대응 메타태그(StatusBar, WebApp Capable) 및 Viewport 고정 설정.
- **오프라인 캐싱**: 서비스 워커를 통한 핵심 자산(폰트, manifest, 아이콘) 로컬 캐싱으로 로딩 속도 및 오프라인 접근성 개선.
- **심플 모드 진입점**: 앱 설치 후 실행 시 바로 심플 모드(`/m/simple`)로 연결되도록 설정.


- **티커 계층 개선**: 티커 코드를 `text-2xl font-black`으로 크게, 보유 수량을 소형 보조 텍스트로 표기하여 정보 계층 명확화.
- **USD/KRW 병기**: 해외 주식 카드에 원화 환산 금액 아래 달러 원가(`$330,230`) 보조 표기 추가. 등락률 배지 내 `(USD)` 라벨 제거.
- **구분선(Rule) 추가**: 티커 정보와 가격 정보 사이에 반투명 1px 구분선 삽입. 위치를 티커 쪽에 가깝게 배치(mb-2/mb-4 비율).
- **보조 텍스트 가시성 개선**: 어두운 카드에서 보조 텍스트 불투명도를 white/60, white/50으로 상향.
- **스크롤 여백 확대**: 하단 pb-24 → pb-40으로 늘려 마지막 카드 잘림 방지.
- **하단 페이드 그라데이션 제거**: 사용자 요청으로 하단 뿌연 오버레이 완전 제거.


- **StockDetailSheet 신규 컴포넌트**: 주식 티커 카드 탭 시 하단에서 슬라이드업되는 상세 Sheet 구현.
- **표시 정보**: 평가 금액, 미실현 손익/수익률, 평단가(USD/KRW 대응), 현재가, 계좌별 보유 수량 및 개별 수익률.
- **스와이프 다운 제거**: 사용 경험이 어색하여 framer-motion 커스텀 드로어를 Radix UI 표준 Sheet로 교체.
- **SimpleModeCard 업데이트**: 주식 카드 클릭 시 `StockDetailSheet`를, 총 자산 카드 클릭 시 `AssetBreakdownSheet`를 열도록 분기 처리.


- **전체 자산 상세 시트 (AssetBreakdownSheet)**: 총 자산 카드 클릭 시 하단에서 슬라이드업되는 자산 상세 내역 시트를 구현. 원화/달러/금/한국주식/해외주식 구분 표시.
- **시트 테마 통일 (White)**: 자산 상세 시트의 배경색을 앱 설정 창과 동일한 순백색(`bg-white`)으로 통일하여 시스템 디자인 일관성 확보.
- **카테고리 아이콘 심플화**: 원색 배경 아이콘을 제거하고 `zinc-50`/`zinc-500` 계열의 차분하고 세련된 모노크롬 스타일로 교체.
- **배경 테마 설정**: 심플 모드에 3가지 배경 테마(Premium Dark, White Silk, Midnight Blue) 선택 기능 추가. 선택 결과가 `localStorage`에 저장되어 영구 유지됨.
- **헤더 겹침 수정 (Safe Area)**: 고정 헤더 아래 여백이 부족하여 "심플 모드" 타이틀이 가려지던 문제를 `env(safe-area-inset-top)` + 80px 패딩으로 해결.
- **설정창 스크롤 및 이벤트 버블링 수정**: 설정창 내부 스크롤 활성화 및 클릭 이벤트 하위 레이어 전파(bubbling) 방지 처리.

- **자동 텍스트 명암비 로직 (YIQ)**: 배경색의 밝기를 수학적으로 계산하여 텍스트 색상을 자동으로 결정하는 로직을 도입함. 중간 톤 색상에서도 최적의 가독성을 보장하도록 개선함.
- **카드 UI 불필요 요소 정리**: 카드 하단의 '보안 실시간 동기화' 문구와 애니메이션을 제거하여 디자인을 더 깔끔하고 현대적으로 정돈함.
- **가시성 강화**: '통합 포트폴리오' 타이틀의 글자색과 투명도를 조정하여 핵심 정보에 대한 주목도를 높임.
- **인터랙션 정교화**: 3초 롱 프레스 트리거 시 설정창(`Sheet`)이 열리지 않도록 클릭 이벤트 차단 플래그를 적용하여 사용자 경험을 선명하게 다듬음.

## [2026-02-27] 모바일 심플 모드 자산 위치 변경 및 인터랙션 고도화
- **카드 위치 변경 (드래그 앤 드롭)**: `framer-motion`을 도입하여 모바일에서 부드럽게 작동하는 자산 카드 순서 변경 기능을 구현함. 변경된 순서는 `localStorage`에 저장되어 영구적으로 유지됨.
- **정교한 롱 프레스 트리거**: 실수로 카드가 이동하는 것을 방지하기 위해 설정 버튼을 3초간 누를 때만 편집 모드에 진입하도록 트리거 로직을 개선함.
- **Floating 애니메이션 적용**: 편집 모드 진입 시 기존의 흔들림 효과 대신 카드가 살짝 공중에 떠오르는(Floating) 효과를 적용하여 시각적 안정감과 프리미엄한 느낌을 강화함.
- **인터랙션 버그 수정**: 3초 롱 프레스 후 손을 뗐을 때 테마 설정창(`Sheet`)이 의도치 않게 열리는 현상을 클릭 이벤트 차단 로직을 통해 해결함.
- **컨텍스트 효율화 스킬 추가**: 새로운 세션 시작 시 `progress.md`를 읽어 즉시 맥락을 파악할 수 있는 `load` 스킬을 개발 및 등록하여 컨텍스트 쿼터 절약을 도모함.
- **환경 설정 워크플로우 보강**: 개발 환경 구축을 위한 `/setup-env` 워크플로우를 `.agents/workflows`로 이동 및 최적화함.

## [2026-02-27] 모바일 심플 모드 구현 및 UI 고도화
- **심플 모드 메뉴 및 페이지 구축**: 모바일 하단 네비게이션에 '심플 모드' 메뉴를 추가하고, 전용 페이지(`/m/simple`)를 생성하여 자산 현황을 한눈에 볼 수 있는 UI를 구현함.
- **이미지 기반 카드 UI 개선**: 사용자가 제공한 뱅킹 앱 디자인을 모티브로 라운딩(`rounded-[32px]`), 폰트 스타일, 차분한 컬러 팔레트 등을 적용하여 프리미엄한 카드 UI를 완성함.
- **가독성 최적화 (Pretendard 도입)**: 한글 가독성을 극대화하기 위해 'Pretendard' 가변 폰트를 전역에 적용하고, 카드 배경색의 밝기에 따라 텍스트 색상을 자동으로 흑/백 전환하는 로직을 구현함.
- **실시간 데이터 연동**: 첫 번째 카드에 사용자 총 자산 가치를, 이어지는 카드들에 보유 주식별 수량, 티커, 로고 심볼 및 실시간 등락률을 원화(KRW) 환산 가치와 함께 표시함.
- **사용자 설정 영속성**: `localStorage`를 연동하여 사용자가 카드별로 지정한 배경색 테마가 새로고침 후에도 유지되도록 구현함.
- **신규 스킬 추가**: 전체 스킬 목록과 설명을 보여주는 `list` 스킬을 개발 및 등록함.

## [2026-02-27] 초기 환경 설정 및 스킬 등록

- **모바일 접속 환경 구축**: 마우스나 키보드 없이 모바일 기기에서 접속 가능하도록 `package.json`에 `dev:mobile` 스크립트(`-H 0.0.0.0`) 추가 및 `.env.mobile` 설정.
- **문서화**: Mac의 인터넷 공유(AP) 모드를 사용하여 접속하는 방법을 `docs/MOBILE_CONNECTION.md`에 상세히 가이드.
- **커밋 자동화 스킬**: `progress.md` 업데이트와 Git 커밋/푸시를 한 번에 처리하는 `commit` 스킬 개발 및 등록.

